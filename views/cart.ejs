<div class="row">
    <div class="col-lg-8">
        <div class="card border-0 shadow-sm mb-4">
            <div class="card-header bg-white py-3">
                <div class="d-flex justify-content-between align-items-center">
                    <h5 class="mb-0">Shopping Cart</h5>
                    <span class="text-muted"><%= cartItems.length %> <%= cartItems.length === 1 ? 'item' : 'items' %></span>
                </div>
            </div>
            <div class="card-body p-0">
                <% if (cartItems.length === 0) { %>
                    <div class="text-center p-5">
                        <div class="mb-4">
                            <i class="fas fa-shopping-cart fa-4x text-muted mb-3"></i>
                            <h4>Your cart is empty</h4>
                            <p class="text-muted">Looks like you haven't added anything to your cart yet.</p>
                        </div>
                        <a href="/gallery" class="btn btn-primary px-5">Browse Gallery</a>
                    </div>
                <% } else { %>
                    <div class="table-responsive">
                        <table class="table align-middle">
                            <thead class="bg-light">
                                <tr>
                                    <th style="width: 120px;">Product</th>
                                    <th>Details</th>
                                    <th class="text-center" style="width: 100px;">Quantity</th>
                                    <th class="text-end" style="width: 150px;">Price</th>
                                    <th style="width: 50px;"></th>
                                </tr>
                            </thead>
                            <tbody>
                                <% cartItems.forEach(item => { %>
                                    <tr class="cart-item" data-id="<%= item.id %>">
                                        <td>
                                            <img src="/images/<%= item.filename %>" alt="<%= item.title %>" class="img-fluid rounded" style="width: 80px; height: 60px; object-fit: cover;">
                                        </td>
                                        <td>
                                            <h6 class="mb-1"><%= item.title %></h6>
                                            <p class="text-muted mb-0"><%= item.category %></p>
                                        </td>
                                        <td class="text-center">
                                            <div class="input-group input-group-sm" style="max-width: 120px;">
                                                <button class="btn btn-outline-secondary btn-sm minus-btn" type="button">-</button>
                                                <input type="number" class="form-control text-center quantity-input" value="<%= item.quantity %>" min="1" data-price="<%= item.price %>" data-id="<%= item.id %>">
                                                <button class="btn btn-outline-secondary btn-sm plus-btn" type="button">+</button>
                                            </div>
                                        </td>
                                        <td class="text-end">
                                            <span class="item-total">$<%= (item.price * item.quantity).toFixed(2) %></span>
                                        </td>
                                        <td class="text-end">
                                            <button class="btn btn-link text-danger p-0 remove-from-cart" data-id="<%= item.id %>">
                                                <i class="far fa-trash-alt"></i>
                                            </button>
                                        </td>
                                    </tr>
                                <% }); %>
                            </tbody>
                        </table>
                    </div>
                <% } %>
            </div>
        </div>
        
        <% if (cartItems.length > 0) { %>
            <div class="d-flex justify-content-between mb-4">
                <a href="/gallery" class="btn btn-outline-primary">
                    <i class="fas fa-arrow-left me-2"></i> Continue Shopping
                </a>
                <button class="btn btn-outline-danger" id="clearCart">
                    <i class="far fa-trash-alt me-2"></i> Clear Cart
                </button>
            </div>
        <% } %>
    </div>
    
    <% if (cartItems.length > 0) { %>
        <div class="col-lg-4">
            <div class="card border-0 shadow-sm">
                <div class="card-body">
                    <h5 class="card-title mb-4">Order Summary</h5>
                    
                    <div class="d-flex justify-content-between mb-3 pb-3 border-bottom">
                        <span>Subtotal</span>
                        <span id="subtotal">$<%= total %></span>
                    </div>
                    
                    <div class="mb-3">
                        <label class="form-label">Shipping</label>
                        <select class="form-select" id="shippingMethod">
                            <option value="standard" selected>Standard Delivery - $5.99</option>
                            <option value="express">Express Delivery - $9.99</option>
                            <option value="free">Free Shipping - $0.00</option>
                        </select>
                    </div>
                    
                    <div class="mb-3">
                        <label for="promoCode" class="form-label">Promo Code</label>
                        <div class="input-group">
                            <input type="text" class="form-control" id="promoCode" placeholder="Enter promo code">
                            <button class="btn btn-outline-secondary" type="button" id="applyPromo">Apply</button>
                        </div>
                    </div>
                    
                    <div class="d-flex justify-content-between mb-1">
                        <span>Shipping</span>
                        <span id="shippingCost">$5.99</span>
                    </div>
                    
                    <div class="d-flex justify-content-between mb-1 text-success" id="discountContainer" style="display: none;">
                        <span>Discount</span>
                        <span id="discountAmount">-$0.00</span>
                    </div>
                    
                    <div class="d-flex justify-content-between mt-4 pt-3 border-top">
                        <span class="fw-bold">Total</span>
                        <span class="fw-bold" id="totalAmount">$<%= (parseFloat(total) + 5.99).toFixed(2) %></span>
                    </div>
                    
                    <div class="d-grid mt-4">
                        <a href="/checkout" class="btn btn-primary btn-lg">Proceed to Checkout</a>
                    </div>
                    
                    <div class="text-center mt-3">
                        <p class="small text-muted mb-0">
                            <i class="fas fa-lock me-1"></i> Secure Checkout
                        </p>
                        <div class="mt-2">
                            <img src="https://cdn.jsdelivr.net/gh/readmeio/payment-method-icons@1.1.0/dist/light/sm/visa.svg" alt="Visa" class="me-2" style="height: 20px;">
                            <img src="https://cdn.jsdelivr.net/gh/readmeio/payment-method-icons@1.1.0/dist/light/sm/mastercard.svg" alt="Mastercard" class="me-2" style="height: 20px;">
                            <img src="https://cdn.jsdelivr.net/gh/readmeio/payment-method-icons@1.1.0/dist/light/sm/amex.svg" alt="American Express" class="me-2" style="height: 20px;">
                            <img src="https://cdn.jsdelivr.net/gh/readmeio/payment-method-icons@1.1.0/dist/light/sm/paypal.svg" alt="PayPal" style="height: 20px;">
                        </div>
                    </div>
                </div>
            </div>
        </div>
    <% } %>
</div>

<% if (cartItems.length > 0) { %>
    <!-- Related Products -->
    <section class="mt-5">
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h3 class="mb-0">You May Also Like</h3>
            <a href="/gallery" class="btn btn-sm btn-outline-primary">View All</a>
        </div>
        
        <div class="row g-4">
            <!-- This would typically be populated with related products from your database -->
            <div class="col-6 col-md-4 col-lg-3">
                <div class="card h-100 border-0 shadow-sm">
                    <div class="position-relative" style="padding-top: 75%;">
                        <img src="https://source.unsplash.com/random/300x300?nature,1" class="card-img-top position-absolute top-0 start-0 w-100 h-100 object-fit-cover" alt="Related Product">
                        <div class="position-absolute top-0 end-0 m-2">
                            <button class="btn btn-sm btn-light rounded-circle p-2">
                                <i class="far fa-heart"></i>
                            </button>
                        </div>
                    </div>
                    <div class="card-body">
                        <h6 class="card-title mb-1">Nature's Beauty</h6>
                        <p class="text-muted small mb-2">Nature</p>
                        <div class="d-flex justify-content-between align-items-center">
                            <span class="fw-bold">$29.99</span>
                            <button class="btn btn-sm btn-outline-primary">
                                <i class="fas fa-plus"></i> Add
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="col-6 col-md-4 col-lg-3">
                <div class="card h-100 border-0 shadow-sm">
                    <div class="position-relative" style="padding-top: 75%;">
                        <img src="https://source.unsplash.com/random/300x300?city,1" class="card-img-top position-absolute top-0 start-0 w-100 h-100 object-fit-cover" alt="Related Product">
                        <div class="position-absolute top-0 end-0 m-2">
                            <button class="btn btn-sm btn-light rounded-circle p-2">
                                <i class="far fa-heart"></i>
                            </button>
                        </div>
                    </div>
                    <div class="card-body">
                        <h6 class="card-title mb-1">Urban Life</h6>
                        <p class="text-muted small mb-2">Urban</p>
                        <div class="d-flex justify-content-between align-items-center">
                            <span class="fw-bold">$34.99</span>
                            <button class="btn btn-sm btn-outline-primary">
                                <i class="fas fa-plus"></i> Add
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="col-6 col-md-4 col-lg-3 d-none d-md-block">
                <div class="card h-100 border-0 shadow-sm">
                    <div class="position-relative" style="padding-top: 75%;">
                        <img src="https://source.unsplash.com/random/300x300?portrait,1" class="card-img-top position-absolute top-0 start-0 w-100 h-100 object-fit-cover" alt="Related Product">
                        <div class="position-absolute top-0 end-0 m-2">
                            <button class="btn btn-sm btn-light rounded-circle p-2">
                                <i class="far fa-heart"></i>
                            </button>
                        </div>
                    </div>
                    <div class="card-body">
                        <h6 class="card-title mb-1">Portrait Session</h6>
                        <p class="text-muted small mb-2">Portrait</p>
                        <div class="d-flex justify-content-between align-items-center">
                            <span class="fw-bold">$49.99</span>
                            <button class="btn btn-sm btn-outline-primary">
                                <i class="fas fa-plus"></i> Add
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="col-6 col-md-4 col-lg-3 d-none d-lg-block">
                <div class="card h-100 border-0 shadow-sm">
                    <div class="position-relative" style="padding-top: 75%;">
                        <img src="https://source.unsplash.com/random/300x300?wildlife,1" class="card-img-top position-absolute top-0 start-0 w-100 h-100 object-fit-cover" alt="Related Product">
                        <div class="position-absolute top-0 end-0 m-2">
                            <button class="btn btn-sm btn-light rounded-circle p-2">
                                <i class="far fa-heart"></i>
                            </button>
                        </div>
                    </div>
                    <div class="card-body">
                        <h6 class="card-title mb-1">Wildlife</h6>
                        <p class="text-muted small mb-2">Animals</p>
                        <div class="d-flex justify-content-between align-items-center">
                            <span class="fw-bold">$39.99</span>
                            <button class="btn btn-sm btn-outline-primary">
                                <i class="fas fa-plus"></i> Add
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>
    
    <script>
    document.addEventListener('DOMContentLoaded', function() {
        // Quantity controls
        document.querySelectorAll('.plus-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                const input = this.previousElementSibling;
                input.stepUp();
                updateQuantity(input);
            });
        });
        
        document.querySelectorAll('.minus-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                const input = this.nextElementSibling;
                if (input.value > 1) {
                    input.stepDown();
                    updateQuantity(input);
                }
            });
        });
        
        // Handle direct input changes
        document.querySelectorAll('.quantity-input').forEach(input => {
            input.addEventListener('change', function() {
                if (this.value < 1) this.value = 1;
                updateQuantity(this);
            });
        });
        
        // Update quantity function
        function updateQuantity(input) {
            const row = input.closest('tr');
            const price = parseFloat(input.dataset.price);
            const quantity = parseInt(input.value);
            const total = (price * quantity).toFixed(2);
            
            // Update the row total
            row.querySelector('.item-total').textContent = `$${total}`;
            
            // In a real app, you would send an AJAX request to update the cart
            // For now, we'll just update the UI
            updateCartTotals();
        }
        
        // Update cart totals
        function updateCartTotals() {
            let subtotal = 0;
            
            document.querySelectorAll('.cart-item').forEach(row => {
                const quantity = parseInt(row.querySelector('.quantity-input').value);
                const price = parseFloat(row.querySelector('.quantity-input').dataset.price);
                subtotal += price * quantity;
            });
            
            const shippingSelect = document.getElementById('shippingMethod');
            let shippingCost = 0;
            
            if (shippingSelect) {
                shippingCost = shippingSelect.value === 'express' ? 9.99 : 
                              shippingSelect.value === 'free' ? 0 : 5.99;
            }
            
            // Apply discount if any
            const discountContainer = document.getElementById('discountContainer');
            const discountAmount = discountContainer.style.display === 'flex' ? 
                                 parseFloat(document.getElementById('discountAmount').textContent.replace('-$', '')) : 0;
            
            const total = subtotal + shippingCost - discountAmount;
            
            // Update the UI
            document.getElementById('subtotal').textContent = `$${subtotal.toFixed(2)}`;
            document.getElementById('shippingCost').textContent = shippingCost > 0 ? `$${shippingCost.toFixed(2)}` : 'Free';
            document.getElementById('totalAmount').textContent = `$${total.toFixed(2)}`;
        }
        
        // Shipping method change
        const shippingSelect = document.getElementById('shippingMethod');
        if (shippingSelect) {
            shippingSelect.addEventListener('change', updateCartTotals);
        }
        
        // Apply promo code
        const applyPromoBtn = document.getElementById('applyPromo');
        if (applyPromoBtn) {
            applyPromoBtn.addEventListener('click', function() {
                const promoCode = document.getElementById('promoCode').value.trim();
                const discountContainer = document.getElementById('discountContainer');
                const discountAmount = document.getElementById('discountAmount');
                
                // In a real app, you would validate the promo code with your backend
                if (promoCode.toUpperCase() === 'WELCOME10') {
                    const subtotal = parseFloat(document.getElementById('subtotal').textContent.replace('$', ''));
                    const discount = (subtotal * 0.1).toFixed(2);
                    
                    discountAmount.textContent = `-$${discount}`;
                    discountContainer.style.display = 'flex';
                    updateCartTotals();
                    
                    showToast('Promo code applied successfully!', 'success');
                } else if (promoCode) {
                    showToast('Invalid promo code', 'error');
                }
            });
        }
        
        // Clear cart
        const clearCartBtn = document.getElementById('clearCart');
        if (clearCartBtn) {
            clearCartBtn.addEventListener('click', function() {
                if (confirm('Are you sure you want to clear your cart?')) {
                    // In a real app, you would send an AJAX request to clear the cart
                    // For now, we'll just reload the page with an empty cart
                    window.location.href = '/cart/clear';
                }
            });
        }
        
        // Initialize cart totals
        updateCartTotals();
    });
    </script>
<% } %>
