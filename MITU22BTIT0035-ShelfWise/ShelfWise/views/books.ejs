<%- include('partials/header', { title: title, currentPage: currentPage }) %>

    <!-- Books Header -->
    <section class="py-5" style="background: linear-gradient(135deg, #114847 0%, #aa594e 100%); color: white; margin-top: 80px;">
        <div class="container text-center">
            <h1 class="display-5 fw-bold mb-3">Our Book Collection</h1>
            <p class="lead">Discover amazing stories from renowned authors around the world</p>
        </div>
    </section>

    <!-- Books Section -->
    <section class="py-5" style="background-color: #F9F6EE;">
        <div class="container">
            <div class="mb-4">
                <form method="GET" action="/books" class="row g-2 align-items-center">
                    <div class="col-md-6 col-lg-4">
                        <label for="genre" class="form-label fw-semibold mb-1" style="color: #114847;">Filter by Genre</label>
                        <select class="form-select form-select-lg" id="genre" name="genre" onchange="this.form.submit()"
                                style="border: 2px solid #e6e6e6; border-radius: 12px; padding: 14px; background-color: white; color: #333;">
                            <option value="all" <%= selectedGenre === 'all' ? 'selected' : '' %>>All Genres</option>
                            <% if (genres && genres.length > 0) { %>
                                <% genres.forEach(function(genre) { %>
                                    <option value="<%= genre %>" <%= selectedGenre === genre ? 'selected' : '' %>><%= genre %></option>
                                <% }) %>
                            <% } %>
                        </select>
                    </div>
                    <div class="col-md-6 col-lg-4">
                        <p class="mb-0 mt-4 mt-md-5" style="color: #666; font-weight: 500;">
                            Showing <strong><%= books.length %></strong> book<%= books.length !== 1 ? 's' : '' %><% if (selectedGenre !== 'all') { %> in <strong><%= selectedGenre %></strong><% } %>
                        </p>
                    </div>
                </form>
            </div>
            <div class="row g-4">
                <% if (books && books.length > 0) { %>
                    <% books.forEach(book => { %>
                        <div class="col-lg-3 col-md-4 col-sm-6">
                            <div class="card h-100 border-0 shadow-sm" style="border-radius: 15px; overflow: hidden; transition: transform 0.3s ease, box-shadow 0.3s ease;">
                                <div style="height: 350px; overflow: hidden;">
                                    <img src="<%= book.image_url %>" 
                                         class="card-img-top" alt="<%= book.title %>"
                                         style="width: 100%; height: 100%; object-fit: cover; transition: transform 0.3s ease;">
                                </div>
                                <div class="card-body p-3 d-flex flex-column">
                                    <div class="d-flex justify-content-between align-items-start mb-2">
                                        <span class="badge px-3 py-2" style="background-color: #114847; color: white; border-radius: 20px; font-weight: 600; font-size: 0.7rem;"><%= book.genre %></span>
                                        <div class="text-warning">
                                            <% for (let i = 1; i <= 5; i++) { %>
                                                <i class="bi <%= i <= Math.floor(book.rating) ? 'bi-star-fill' : 'bi-star' %>" style="font-size: 0.8rem;"></i>
                                            <% } %>
                                            <small class="text-muted ms-1">(<%= book.rating %>)</small>
                                        </div>
                                    </div>
                                    
                                    <h6 class="card-title fw-bold mb-1" style="color: #114847; line-height: 1.3; font-size: 1rem;"><%= book.title %></h6>
                                    <p class="text-muted mb-2" style="font-size: 0.85rem;">by <strong><%= book.author %></strong></p>
                                    
                                    <p class="card-text flex-grow-1 mb-3" style="color: #666; line-height: 1.5; font-size: 0.85rem;"><%= book.description.substring(0, 100) %>...</p>
                                    
                                    <% if (book.stock_quantity) { %>
                                        <p class="small mb-2" style="color: #666;">
                                            <i class="bi bi-box"></i> <%= book.stock_quantity %> in stock
                                        </p>
                                    <% } %>
                                    
                                    <div class="d-flex justify-content-between align-items-center">
                                        <div class="h6 mb-0 fw-bold" style="color: #aa594e;">â‚¹<%= book.price %></div>
                                        <form action="/cart/add" method="POST" class="d-inline">
                                            <input type="hidden" name="book_id" value="<%= book.id %>">
                                            <input type="hidden" name="quantity" value="1">
                                            <button type="submit" class="btn btn-primary btn-sm px-3" 
                                                    <%= book.stock_quantity && book.stock_quantity > 0 ? '' : 'disabled' %>
                                                    style="border-radius: 20px; font-size: 0.8rem;">
                                                <i class="bi bi-cart-plus me-1"></i> Add
                                            </button>
                                        </form>
                                    </div>
                                </div>
                            </div>
                        </div>
                    <% }); %>
                <% } else { %>
                    <div class="col-12 text-center">
                        <div class="alert alert-info border-0" style="background-color: white; color: #114847;">
                            <i class="bi bi-info-circle me-2"></i> No books available at the moment. Check back soon!
                        </div>
                    </div>
                <% } %>
            </div>
        </div>
    </section>

    <script>
        // Card hover effects for books page
        document.querySelectorAll('.card').forEach(card => {
            card.addEventListener('mouseenter', function() {
                this.style.transform = 'translateY(-8px)';
                this.style.boxShadow = '0 15px 35px rgba(0,0,0,0.2)';
                const img = this.querySelector('img');
                if (img) img.style.transform = 'scale(1.05)';
            });
            
            card.addEventListener('mouseleave', function() {
                this.style.transform = 'translateY(0)';
                this.style.boxShadow = '0 4px 6px rgba(0,0,0,0.1)';
                const img = this.querySelector('img');
                if (img) img.style.transform = 'scale(1)';
            });
        });
    </script>

<%- include('partials/footer') %>
